<details>
<summary> 1장 사용자 수에 따른 규모 확장성</summary>
<div markdown="1">
1. 단일 서버 - 웹 앱, 데이터베이스, 캐시 등 전부 서버 1대에서 실행
    
   - request 흐름
        
        도메인 검색 → **1)** host 파일 **2)** DNS cache **3)** DNS query → IP 주소 반환 → 해당 IP 주소로 HTTP 요청 전달 → 결과 리턴
        
2. 관계형 데이터베이스(RDBMS) vs 비관계형 데이터베이스(NoSQL)
    - 관계형 DB
        - **정해진 스키마에 따라 데이터를 테이블에 저장하는 데이터베이스**
        - **데이터 구조를 보장하고 중복을 피할 수 있다.**
        - SQL을 사용하면 RDBMS에서 데이터를 저장, 수정, 삭제 및 검색 할 수 있다.
        - 데이터는 관계를 통해 여러 테이블에 분산된다.
        - 수직적 확장이 가능하다(단순히 서버의 성능을 향상시키는 것)
        - 고정된 행(row)과 열(column)로 구성된 테이블에 데이터를 저장한다.
        - 각 열은 하나의 속성에 대한 정보를 저장하고, 행에는 각 열의 데이터 형식에 맞는 데이터가 저장된다.
        - 관계형 데이터베이스에서는 테이블의 구조와 데이터 타입 등을 사전에 정의한다. 그리고 테이블에 정의된 내용에 알맞은 형태의 데이터만 삽입할 수 있다.
        - 특정한 형식을 지키기 때문에, 데이터를 정확히 입력했다면 데이터를 사용할 때에는 매우 수월하다.
        - 사용처
            - **관계를 맺고 있는 데이터가 자주 변경되는 경우**
            - 변경될 여지가 없고, 명확한 스키마가 사용자와 데이터에게 중요한 경우
    - NoSQL
        - **스키마가 없거나 느슨한 스키마로 데이터 간의 관계없이 자유로운 형태로 데이터를 저장하는 데이터베이스**
        - 유연하기 때문에 언제든지 데이터를 조정하고 새로운 필드를 추가할 수 있다.
        - 중복을 계속 업데이트해야하는 단점이 있다.
        - **수평적 확장** 으로 **트래픽 분산 및 대용량 처리** 가 가능하다.
        - 레코드를 문서(documents)라고 부른다.
        - Eventual Consistency -Consistency를 보장해주지 못하기 때문에 나온 개념으로, Consistency를 완전히 보장하지는 않지만, 결과적으로 언젠가는 Conssistency가 보장됨을 의미
        - 비관계형 데이터베이스란 관계형 데이터베이스를 뺀 나머지 유형을 총칭하는 뜻이다.
        - NoSQL 데이터베이스(일명 “SQL만을 사용하지 않는 데이터베이스”)는 표 형식이 아니며, 관계형 테이블과는 다른 방식으로 데이터를 저장한다.
        - 이들은 유연한 스키마를 제공하며, 대량의 데이터와 높은 사용자 부하에서도 손쉽게 확장이 가능하다.
        - 사용처
            - **읽기를 자주 하지만 데이터 변경은 자주 없는경우**
            - 정확한 데이터 구조를 알 수 없거나, 변경/확장될 수 있는 경우
            - 데이터베이스를 수평적으로 확장해야하는 경우(막대한 양의 데이터를 다루는 경우)
    
3. 언제 NoSQL을 선택할까?
    1. 아주 낮은 응답 지연시간(latency)이 요구
    2. 다루는 데이터가 비정형(unstructured, 멀티미디어나 워드나, 이미지, 영상, pdf 등 행과 열로 구분하기 어려운 데이터)이라 관계형 데이터가 아닌 경우
    3. 데이터를 직렬화하거나 역직렬화 할 수 있기만 하면 됨
    4. 아주 많은 양의 데이터를 저장할 필요가 있음
    
4. scale up(수직적 확장, 한 대의 서버) vs scale out(수평적 확장, 여러 대의 서버로)
    
    
5. 로드밸런서 역할
    1. 웹 서버는 클라이언트의 요청을 직접 처리하지 않음
    2. public IP로 온 요청을 로드밸런서가 받고 그걸 private IP를 이용하여 웹 서버와 통신한다.
    3. 장애를 자동복구하지 못하는 문제(no failover)가 해소, 웹 계층의 availability(가용성)가 향상
    4. 웹서버 계층에 더 많은 서버를 추가하기만하면 로드밸런서가 자동적으로 트래픽을 분산
    
6. 데이터베이스 다중화
    1. 서버 사이에 주(master)-부(slave) 관계 설정, 데이터 원본은 주, 사본은 부 서버에 보관
    2. 쓰기 연산은 마스터에서만 지원, 부 서버에서는 읽기 연산만 지원.
    3. 장점
        1. 더 나은 성능 : 병렬로 처리할 수 있는 질의의 수가 늘어나 성능이 좋아진다. 
        2. 안정성 : 데이터를 지역적으로 떨어진 장소에 다중화시켜놓을 수 있다.
        3. 가용성 : 한개의 데이터베이스 서버에 장애가 발생하더라도 다른 서버에 있는 데이터를 가져와 계속 서비스할 수 있다.
        
7. 캐시 사용시 유의할점
    1. 데이터 갱신은 자주 일어나지 않지만 참조가 빈번하게 일어나는 경우에 사용을 고려한다.
    2. 캐시는 휘발성 메모리에 두기때문에 영속적으로 보관할 데이터는 캐시에 두지 않는다.
    3. 만료정책을 적절하게 설정해야한다.
    4. 데이터 저장소의 원본과 캐시 내의 사본을 같게 유지(일관성)해야한다.
    5. 어떤 특정 지점에서의 장애(단일 장애 지점, SPOF)가 전체 시스템의 동작을 중단시켜버리는 일을 피해야한다. → 여러 지역에 걸쳐 캐시서버를 분산시켜야한다.
    6. 캐시 메모리를 과할당하여 데이터가 갑자기 늘어났을 때의 문제를 방지해야한다.
    7. 데이터 방출 정책
        1. LRU : 마지막으로 사용된 시점이 가장 오래된 데이터 방출
        2. LFU : 사용빈도가 가장 낮은 데이터 방출
        3. FIFO : 가장 먼저 캐시에 들어온 데이터를 가장 먼저 방출
    
8. CDN(Content Delivery Network, 콘텐츠 전송 네트워크)
    1. 정적 컨텐츠(JS, CSS, image etc)를 전송하는, 지리적으로 분산된 서버의 네트워크
    2. 동작 방식
        1. 사용자가 이미지 URL을 이용해 접근
        2. CDN 서버의 캐시에 이미지 확인 → 없으면 origin 서버에 요청
        3. 리턴된 파일은 TTL(Time-To-Live, 얼마나 오래 캐시될 수 있는지) 값을 포함 
        4. CDN 서버는 파일을 캐시하고 사용자에게 반환
    3. 고려 사항
        1. 비용, 적절한 만료 시한 설정, CDN 장애 상황, 콘텐츠 무효화(invalidation) 방법
        
9. stateless 아키텍처
    1. 상태 정보를 물리적으로 웹 서버로부터 분리되어 단순하고 안정적이면서 확장이 쉬운 아키텍처
    
10. 데이터센터
    1. geoDNS-routing(geo-routing) : 사용자에게서 가장 가까운 데이터센터로 트래픽을 보낼 수 있게 함
    2. 다중 데이터센터 아키텍처의 몇 가지 고려할 점
        1. 트래픽 우회 - 올바른 데이터 센터로 트래픽을 보내는 방법
        2. 데이터 동기화 
        3. 테스트와 배포 - 여러 위치에서 테스트해보는 것이 중요
    
11. 메시지 큐
    1. 메시지의 무손실(durability, 메시지 큐에 보관된 메시지는 소비자가 꺼낼 때까지는 안전히 보관)을 보장하는 비동기 통신을 지원하는 컴포넌트
    2. 장점 - 결합 감소(loosly coupled), 규모 확장성 보장, 안정적
    
12.  로그 메트릭 그리고 자동화
    
    - 로그 : 시스템의 오류와 문제들을 쉽게 찾아낼 수 있도록 함
    
    - 메트릭 
        - 호스트 단위 메트릭 : CPU, 메모리, 디스크 I/O에 관한 메트릭
        - 종합 메트릭 : DB계층의 성능, 캐시 계층의 성능
        - 핵심 비즈니스 메트릭 : 일별 능동 사용자, 수익, 재방문 등
    
    - 자동화 : 시스템이 크고 복잡해지면 생산성을 높이기위해 자동화 도구를 활용
    
13. 데이터베이스 수평적 확장 (샤딩)
    - 대규모 데이터베이스를 shard라는 작은 단위로 분할, 모든 샤드는 같은 스키마를 쓰지만 샤드에 보관하는 데이터엔 중복이 없다.
    - 샤딩 키를 정하여 데이터를 분산한다.
    - 샤딩 키를 통해 올바른 데이터베이스에 질의를 보내어 데이터 조회나 변경을 처리하므로 효율을 높일 수 있다.
    - 샤딩 도입시 발생할 수 있는 문제
        - 데이터의 재 샤딩
            - 하나의 샤드로 더이상 감상하기 어려울 때나 샤드 간 데이터 분포가 균등하지 못하여 어떤 샤드에 할당된 공간 소모가 다른 샤드에 비해 빨리 소진될 때 재 샤딩이 필요하다.
            - 안정 해시(consistent hashing) 기법을 활용하여 문제 해결
        - celebrity 문제(hotspot key)
            - 특정 샤드에 질의가 집중되어 서버에 과부하가 생기는 문제
            - hotspot마다 샤드 하나씩을 할당하거나 심지어 더 작게 쪼갤 수도 있다.
        - 조인과 비정규화
            - 하나의 데이터베이스를 쪼개면 조인이 힘들어져 비정규화를 고려하기도 함
    
14. 정리
    - 웹 계층은 stateless
    - 모든 계층에 다중화 도입
    - 가능한 많은 데이터를 캐시할 것
    - 여러 데이터 센터를 지원할 것
    - 정적 컨텐츠는 CDN을 통해 서비스할 것
    - 데이터 계층은 샤딩을 통해 그 규모를 확장할 것
    - 각 계층은 독립적 서비스로 분할할 것
    - 시스템은 지속적으로 모니터링하고, 자동화 도구들을 활용할 것

</div>
</details>
